# tRPC-GO RESTful [中文主页](README_CN.md)

---

## How does transcoder work

Unlike other transport plugins of tRPC-Go, restful transport plugin implements a tRPC/HTTPJSON transcoder in Transport Layer.
Therefore, Codec layer is not needed. The PB message from transcoding could be directly used by the REST Stub generated by trpc-go-cmdline.

## Core of transcoder: HttpRule

Please refer to trpc-go/internal/httprule for more details of HttpRule.

A few examples below could be used to show how HttpRule works.

**1. url path matching**

```protobuf
service Messaging {
  rpc GetMessage(GetMessageRequest) returns (Message) {
    option (trpc.api.http) = {
        get: "/v1/{name=messages/*}"
    };
  }
}

message GetMessageRequest {
  string name = 1; // Mapped to URL path.
}

message Message {
  string text = 1; // The resource content.
}
```

The HttpRule leads to the following matching:

| HTTP | tRPC |
 | ----- | ----- |
| GET /v1/messages/123456 | GetMessage(name: "messages/123456") |

**2. nested proto message**

```protobuf
service Messaging {
  rpc GetMessage(GetMessageRequest) returns (Message) {
    option (trpc.api.http) = {
        get:"/v1/messages/{message_id}"
    };
  }
}

message GetMessageRequest {
  message SubMessage {
    string subfield = 1;
  }
  string message_id = 1; // Mapped to URL path.
  int64 revision = 2;    // Mapped to URL query parameter `revision`.
  SubMessage sub = 3;    // Mapped to URL query parameter `sub.subfield`.
}
```

The HttpRule leads to the following matching:

| HTTP | tRPC |
 | ----- | ----- |
| GET /v1/messages/123456?revision=2&sub.subfield=foo | GetMessage(message_id: "123456" revision: 2 sub: SubMessage(subfield: "foo")) |

**3. a certain field specified by HttpRule Body**

```protobuf
service Messaging {
  rpc UpdateMessage(UpdateMessageRequest) returns (Message) {
    option (trpc.api.http) = {
      post: "/v1/messages/{message_id}"
      body: "message"
    };
  }
}

message UpdateMessageRequest {
  string message_id = 1; // mapped to the URL
  Message message = 2;   // mapped to the body
}
```

The HttpRule leads to the following matching:

| HTTP | tRPC |
 | ----- | ----- |
| POST /v1/messages/123456 { "text": "Hi!" } | UpdateMessage(message_id: "123456" message { text: "Hi!" }) |

**4. HttpRule Body wildcard**

```protobuf
service Messaging {
  rpc UpdateMessage(Message) returns (Message) {
    option (trpc.api.http) = {
      post: "/v1/messages/{message_id}"
      body: "*"
    };
  }
}

message Message {
  string message_id = 1;
  string text = 2;
}
```

The HttpRule leads to the following matching:

| HTTP | tRPC |
 | ----- | ----- |
| POST/v1/messages/123456 { "text": "Hi!" } | UpdateMessage(message_id: "123456" text: "Hi!") |

**5. using additional_bindings to append more rules**

```protobuf
service Messaging {
  rpc GetMessage(GetMessageRequest) returns (Message) {
    option (trpc
            .api.http) = {
      get: "/v1/messages/{message_id}"
      additional_bindings {
        get: "/v1/users/{user_id}/messages/{message_id}"
      }
    };
  }
}

message GetMessageRequest {
  string message_id = 1;
  string user_id = 2;
}
```

The HttpRule leads to the following matching:

| HTTP | tRPC |
 | ----- | ----- |
| GET /v1/messages/123456 | GetMessage(message_id: "123456") |
| GET /v1/users/me/messages/123456 | GetMessage(user_id: "me" message_id: "123456") |
